<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Configuration | SHARL-TECH</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Syncopate:wght@400;700&family=Space+Grotesk:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <!-- Favicon -->
    <link rel="icon" type="image/jpeg" href="images/logo.jpg">
    <link rel="apple-touch-icon" href="images/logo.jpg">

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QWS107WYBZ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-QWS107WYBZ');
    </script>
    <style>
        .order-container {
            padding: 150px 20px 80px;
            max-width: 1000px;
            margin: 0 auto;
            min-height: 100vh;
        }

        .order-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
        }

        /* Order Summary Panel */
        .order-summary {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border-light);
            padding: 40px;
            backdrop-filter: blur(10px);
            position: sticky;
            top: 150px;
            height: fit-content;
        }

        .order-header {
            border-bottom: 1px solid var(--border-light);
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .order-type {
            font-size: 0.9rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 10px;
        }

        .order-title {
            font-size: 2.5rem;
            color: white;
            margin-bottom: 10px;
        }

        .order-price {
            font-size: 2rem;
            color: #4ade80;
            font-family: var(--font-heading);
            font-weight: 700;
        }

        .order-desc {
            color: #ccc;
            margin-bottom: 30px;
            font-size: 1rem;
        }

        .order-features {
            list-style: none;
        }

        .order-features li {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            color: #eee;
        }

        .order-features li i {
            color: #4ade80;
        }

        /* Requisition Form Panel */
        .requisition-panel {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid var(--border-light);
            padding: 40px;
        }

        .req-header {
            margin-bottom: 30px;
            text-align: center;
        }

        .req-header h3 {
            font-size: 1.8rem;
        }

        .req-id {
            font-family: 'Courier New', Courier, monospace;
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .order-layout {
                grid-template-columns: 1fr;
                gap: 30px;
            }

            .order-summary {
                position: relative;
                top: 0;
                margin-bottom: 30px;
            }

            .order-container {
                padding: 100px 20px 40px;
            }
        }
    </style>
</head>

<body>
    <!-- 3D Background Canvas -->
    <div id="canvas-container"></div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="logo">
            <img src="images/logo.jpg" alt="SHARL-TECH Logo" class="logo-img">
            <span>SHARL-TECH</span>
        </div>
        <ul class="nav-links">
            <li><a href="index.html#services">Services</a></li>
            <li><a href="pricing.html">Pricing</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="index.html#contact" class="btn-nav">Contact Us</a></li>
        </ul>
        <div class="hamburger"><i class="fas fa-bars"></i></div>
    </nav>

    <div class="container order-container">
        <div class="order-layout">
            <!-- Left: Dynamic Order Summary -->
            <div class="order-summary" id="order-summary">
                <div class="order-header">
                    <div class="order-type" id="item-type">SELECTED PLAN</div>
                    <h2 class="order-title" id="item-title">Loading...</h2>
                    <div class="order-price" id="item-price">--</div>
                </div>
                <p class="order-desc" id="item-desc">Please wait while we retrieve the details from the database.</p>
                <ul class="order-features" id="item-features">
                    <!-- Features injected here -->
                </ul>
            </div>

            <!-- Right: Contact Form -->
            <div class="requisition-panel"
                style="position: relative; overflow: hidden; border: 1px solid rgba(142, 197, 73, 0.3); box-shadow: 0 0 20px rgba(142, 197, 73, 0.1);">
                <!-- Secure Status Bar -->
                <div
                    style="background: rgba(142, 197, 73, 0.1); padding: 8px 15px; margin: -40px -40px 30px -40px; border-bottom: 1px solid rgba(142, 197, 73, 0.2); display: flex; align-items: center; justify-content: space-between; font-family: 'Courier New', monospace; font-size: 0.8rem; color: #8ec549;">
                    <span><i class="fas fa-lock"></i> SECURE ORDER FORM</span>
                    <span id="connection-status">CONNECTION SECURE</span>
                </div>

                <div class="req-header">
                    <h3 style="color: #fff; margin-bottom: 5px;">COMPLETE YOUR ORDER</h3>
                    <div class="req-id">SESSION ID: <span id="session-id" style="color: #4ade80;"></span></div>
                    <p style="color: #aaa; font-size: 0.9rem; margin-top: 10px;">Please confirm your contact details
                        below.</p>
                </div>

                <form class="transmission-form" onsubmit="event.preventDefault(); handleForm(this);">
                    <input type="hidden" id="form-item-name" name="item_name">

                    <div class="input-group">
                        <input type="text" name="name" required style="border-color: rgba(255,255,255,0.2);">
                        <label><i class="fas fa-user-astronaut"></i> Full Name</label>
                        <span class="focus-border"></span>
                    </div>
                    <div class="input-group">
                        <input type="email" name="email" required style="border-color: rgba(255,255,255,0.2);">
                        <label><i class="fas fa-envelope"></i> Email Address</label>
                        <span class="focus-border"></span>
                    </div>
                    <div class="input-group">
                        <input type="tel" name="phone" style="border-color: rgba(255,255,255,0.2);">
                        <label><i class="fas fa-mobile-alt"></i> Phone Number (Optional)</label>
                        <span class="focus-border"></span>
                    </div>
                    <div class="input-group">
                        <textarea name="notes" rows="4" style="border-color: rgba(255,255,255,0.2);"></textarea>
                        <label><i class="fas fa-file-alt"></i> Additional Project Details</label>
                        <span class="focus-border"></span>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block"
                        style="background: #8ec549; color: #000; font-weight: bold; border: none; padding: 15px; letter-spacing: 1px; text-transform: uppercase;">
                        Confirm Order <i class="fas fa-rocket" style="margin-left: 10px;"></i>
                    </button>
                    <div style="text-align: center; margin-top: 15px; font-size: 0.8rem; color: #666;">
                        <i class="fas fa-shield-alt"></i> Data is encrypted and secure.
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- WhatsApp Widget -->
    <a href="https://wa.me/254707575397" class="whatsapp-float" target="_blank">
        <i class="fab fa-whatsapp"></i>
        <span class="whatsapp-tooltip">Contact Us on WhatsApp</span>
    </a>

    <script src="script.js"></script>
    <script>
        // Data Store (Duplicated from script.js + Pricing Data)
        const db = {
            plans: {
                'starter': {
                    type: 'Package',
                    title: 'The Launchpad',
                    price: 'KES 13,500',
                    desc: 'Perfect for small businesses establishing a digital footprint.',
                    features: ['Single Page Design', 'Free .co.ke Domain', 'Basic Hosting (1 Yr)', 'Social Media Links']
                },
                'business': {
                    type: 'Package',
                    title: 'Business Pro',
                    price: 'KES 19,500 - 25,000',
                    desc: 'A robust solution for growing companies needing more interactions.',
                    features: ['Up to 10 Pages', 'Standard Hosting', 'Free .co.ke Domain', 'WhatsApp Integration']
                },
                'executive': {
                    type: 'Package',
                    title: 'E-Commerce Suite',
                    price: 'KES 40,000+',
                    desc: 'The ultimate digital command center for online stores.',
                    features: ['Full Product Catalog', 'M-Pesa Integration', 'Free .co.ke Domain', 'Free SSL Certificate']
                }
            },
            services: {
                'web': {
                    type: 'Service',
                    title: 'Web Design',
                    price: 'Custom Quote',
                    desc: 'Custom, responsive, and aesthetic websites tailored to your brand.',
                    features: ['Responsive UI', 'Custom Branding', 'SEO Ready', 'Fast Loading']
                },
                'hosting': {
                    type: 'Service',
                    title: 'Web Hosting',
                    price: 'Starting from KES 3,000/yr',
                    desc: 'Reliable, high-speed hosting solutions ensuring your site is always online.',
                    features: ['99.9% Uptime', 'SSD Storage', 'Daily Backups', '24/7 Support']
                },
                'seo': {
                    type: 'Service',
                    title: 'SEO & Marketing',
                    price: 'Custom Quote',
                    desc: 'Boost your visibility and drive traffic with data-driven strategies.',
                    features: ['Keyword Analysis', 'On-Page Optimization', 'Content Strategy']
                },
                'app': {
                    type: 'Service',
                    title: 'App Development',
                    price: 'Custom Quote',
                    desc: 'Native and cross-platform mobile applications for iOS and Android.',
                    features: ['iOS & Android', 'Modern UI/UX', 'Cloud Integration']
                },
                'repair': {
                    type: 'Service',
                    title: 'IT Repair',
                    price: 'Service Based',
                    desc: 'Expert hardware diagnostics and repair for all devices.',
                    features: ['Hardware Repair', 'Software Fixes', 'Virus Removal']
                },
                'domain': {
                    type: 'Service',
                    title: 'Domain Registration',
                    // Define servicesData logic LOCALLY to ensure it exists before parsing
                    // (This acts as a fallback if script.js loads late or fails)
                    const servicesData = {
                        'web': {
                            type: 'SERVICE',
                            title: 'Web Design',
                            price: 'Custom',
                            desc: 'Custom, responsive, and aesthetic websites tailored to your brand.',
                            features: ['Responsive UI', 'Custom Branding', 'SEO Ready', 'Fast Loading']
                        },
                        'hosting': {
                            type: 'SERVICE',
                            title: 'Web Hosting',
                            price: 'KES 5,000/yr',
                            desc: 'Reliable, high-speed hosting solutions ensuring your site is always online.',
                            features: ['99.9% Uptime', 'SSD Storage', 'Daily Backups', '24/7 Support']
                        },
                        'seo': {
                            type: 'SERVICE',
                            title: 'SEO & Marketing',
                            price: 'KES 15,000/mo',
                            desc: 'Boost your visibility and drive traffic with our data-driven strategies.',
                            features: ['Keyword Analysis', 'On-Page Optimization', 'Content Strategy', 'Traffic Analytics']
                        },
                        'app': {
                            type: 'SERVICE',
                            title: 'App Development',
                            price: 'Custom',
                            desc: 'Native and cross-platform mobile applications.',
                            features: ['iOS & Android', 'Modern UI/UX', 'Cloud Integration', 'Maintenance']
                        },
                        'starter': { // Added Package Definitions
                            type: 'PACKAGE',
                            title: 'Starter Package',
                            price: 'KES 25,000',
                            desc: 'Perfect for small businesses or personal portfolios.',
                            features: ['5 Page Website', '1 Year Free Hosting', 'Basic SEO', 'Inquiry Form', 'Social Media Links']
                        },
                        'business': { // Added Package Definitions
                            type: 'PACKAGE',
                            title: 'Business Package',
                            price: 'KES 45,000',
                            desc: 'Ideal for growing businesses needing dynamic features.',
                            features: ['10 Page Website', 'CMS Integration', 'Advanced SEO', 'Blog Section', 'Google Analytics']
                        },
                        'executive': { // Added Package Definitions
                            type: 'PACKAGE',
                            title: 'Executive Package',
                            price: 'KES 80,000',
                            desc: 'Full-scale solution for established enterprises.',
                            features: ['Unlimited Pages', 'E-commerce (10 products)', 'Priority Support', 'Custom Functionality', 'Yearly Maintenance']
                        }
                    };

                    // Parse URL parameters
                    const urlParams = new URLSearchParams(window.location.search);
                    const serviceKey = urlParams.get('service');
                    const quoteDataParam = urlParams.get('quote_data');

                    let selectedItem = null;

                    if(serviceKey && servicesData[serviceKey]) {
                        selectedItem = servicesData[serviceKey];
        }

        // Generate Random Session ID
        document.getElementById('session-id').innerText = 'REQ-' + Math.floor(Math.random() * 100000);

        // Populate Content
        if (selectedItem) {
            document.getElementById('item-type').innerText = selectedItem.type;
            document.getElementById('item-title').innerText = selectedItem.title;
            document.getElementById('item-price').innerText = selectedItem.price;
            document.getElementById('item-desc').innerText = selectedItem.desc;
            document.getElementById('form-item-name').value = selectedItem.title;

            // Set form hidden input and dynamic redirect URL
            const formItem = document.getElementById('form-item-name');
            if (formItem) {
                // The value is already set above, but ensuring consistency if this block was moved
                formItem.value = selectedItem.title || 'General Inquiry';

                // Dynamic Redirect URL
                const nextInput = document.querySelector('input[name="_next"]');
                if (nextInput) {
                    // Ensure this matches your netlify domain exactly
                    nextInput.value = `https://sharl-tech.netlify.app/thank-you.html?item=${encodeURIComponent(formItem.value)}`;
                }
            }

            const featureList = document.getElementById('item-features');
            featureList.innerHTML = selectedItem.features.map(f => `<li><i class="fas fa-check"></i> ${f}</li>`).join('');

            // --- GENERATE INVOICE DATA FOR STANDARD PACKAGE ---
            let invoiceRows = `
                <tr style="border-bottom: 1px solid #333;">
                    <td style="padding: 10px; color: #ddd;">${selectedItem.title}</td>
                    <td style="padding: 10px; text-align: right; color: #4ade80; font-family: monospace;">${selectedItem.price}</td>
                </tr>`;

            const form = document.querySelector('.transmission-form');

            // Hidden Input: invoice_items
            let invoiceInput = document.getElementById('invoice-items');
            if (!invoiceInput) {
                invoiceInput = document.createElement('input');
                invoiceInput.type = 'hidden';
                invoiceInput.name = 'invoice_items';
                invoiceInput.id = 'invoice-items';
                form.appendChild(invoiceInput);
            }
            invoiceInput.value = invoiceRows;

            // Hidden Input: total_amount
            let totalInput = document.getElementById('total-amount');
            if (!totalInput) {
                totalInput = document.createElement('input');
                totalInput.type = 'hidden';
                totalInput.name = 'total_amount';
                totalInput.id = 'total-amount';
                form.appendChild(totalInput);
            }
            totalInput.value = selectedItem.price;

            // CHECK FOR CUSTOM QUOTE DATA
        } else if (urlParams.get('quote_data')) {
            try {
                const quoteData = JSON.parse(decodeURIComponent(urlParams.get('quote_data')));

                document.getElementById('item-type').innerText = "CUSTOM QUOTE";
                document.getElementById('item-title').innerText = "Your Configuration";
                document.getElementById('item-price').innerText = quoteData.total;
                document.getElementById('item-desc').innerText = "A tailored solution configured to your specific needs.";

                document.getElementById('form-item-name').value = "Custom Web Quote";

                const featureList = document.getElementById('item-features');
                let featuresHTML = '';

                featuresHTML += `<li><i class="fas fa-layer-group"></i> <strong>Service:</strong> ${quoteData.service.name}</li>`;
                featuresHTML += `<li><i class="fas fa-server"></i> <strong>Hosting:</strong> ${quoteData.hosting.name}</li>`;
                featuresHTML += `<li><i class="fas fa-globe"></i> <strong>Domain:</strong> ${quoteData.domain.name}</li>`;

                if (quoteData.addons.length > 0) {
                    featuresHTML += `<li><i class="fas fa-tools"></i> <strong>Add-ons:</strong> ${quoteData.addons.join(', ')}</li>`;
                } else {
                    featuresHTML += `<li><i class="fas fa-ban"></i> No Add-ons Selected</li>`;
                }

                featureList.innerHTML = featuresHTML;

                // Prepare Invoice Items HTML for Email HTML Table
                // Format: <tr style="border-bottom:1px solid #ddd;"> <td style="padding:10px;">Item Name</td> <td style="padding:10px;text-align:right;">Price</td> </tr>
                let invoiceRows = '';

                const addRow = (item, price) => {
                    let displayPrice = price;
                    if (typeof price === 'number') {
                        displayPrice = "KES " + price.toLocaleString();
                    }

                    invoiceRows += `
                        <tr style="border-bottom: 1px solid #333;">
                            <td style="padding: 10px; color: #ddd;">${item}</td>
                            <td style="padding: 10px; text-align: right; color: #4ade80; font-family: monospace;">${displayPrice}</td>
                        </tr>`;
                };

                // Add Service
                addRow(quoteData.service.name, quoteData.service.price);
                // Add Hosting
                addRow(quoteData.hosting.name, quoteData.hosting.price);
                // Add Domain
                addRow(quoteData.domain.name, quoteData.domain.price);
                // Add Addons
                if (quoteData.addons.length > 0) {
                    quoteData.addons.forEach(addon => {
                        // Assumption: Addon price is not split in the array, using placeholder or generic text if precise price isn't captured per item in array. 
                        // In logic, addons was just array of strings. We'll list them.
                        // Ideally we should fix the upstream logic to capture price objects, but for now:
                        addRow(addon, "-");
                    });
                }

                // Create Hidden Input for Invoice HTML
                const form = document.querySelector('.transmission-form');

                let invoiceInput = document.getElementById('invoice-items');
                if (!invoiceInput) {
                    invoiceInput = document.createElement('input');
                    invoiceInput.type = 'hidden';
                    invoiceInput.name = 'invoice_items';
                    invoiceInput.id = 'invoice-items';
                    form.appendChild(invoiceInput);
                }
                invoiceInput.value = invoiceRows;

                let totalInput = document.getElementById('total-amount');
                if (!totalInput) {
                    totalInput = document.createElement('input');
                    totalInput.type = 'hidden';
                    totalInput.name = 'total_amount';
                    totalInput.id = 'total-amount';
                    form.appendChild(totalInput);
                }
                totalInput.value = quoteData.total;

            } catch (e) {
                console.error("Error parsing quote data", e);
                document.getElementById('item-title').innerText = 'Error Loading Quote';
            }

        } else {
            document.getElementById('item-title').innerText = 'Item Not Found';
            document.getElementById('item-desc').innerText = 'The requested service or package could not be located.';
        }
    </script>
</body>

</html>